[mysqld]

# InnoDB Buffer Pool - Most important setting for performance
# Set to 50-70% of available RAM (adjust based on your system)
# For 8GB RAM: 4G, for 16GB RAM: 8G, for 32GB RAM: 16G
innodb_buffer_pool_size = 4G
# Note: innodb_buffer_pool_instances removed in MariaDB 12.x (auto-configured)

# InnoDB Log Files - Larger logs = better write performance
innodb_log_file_size = 512M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2  # 2=faster, 1=safer but slower

# InnoDB I/O Configuration
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000
innodb_read_io_threads = 8
innodb_write_io_threads = 8
# Note: innodb_flush_method deprecated in MariaDB 12.x (auto-configured)

# Query Cache (deprecated in newer versions but useful if available)
query_cache_size = 256M
query_cache_type = 1
query_cache_limit = 4M

# Join and Sort Buffers - Important for multi-transfer searches
join_buffer_size = 16M
sort_buffer_size = 16M
read_rnd_buffer_size = 8M

# Temporary Tables - For complex joins with clustered data
tmp_table_size = 512M
max_heap_table_size = 512M

# Table Cache
table_open_cache = 4000
table_definition_cache = 2000

# Connection Settings
max_connections = 200
max_allowed_packet = 64M

# Thread Cache
thread_cache_size = 50

# MyISAM Settings (if you have any MyISAM tables)
key_buffer_size = 256M

# Timeouts - Aligned with your application's timeout handling
max_statement_time = 300  # 5 minutes max query time (MariaDB)
wait_timeout = 600
interactive_timeout = 600

# Performance Schema (disable for test env to save memory)
performance_schema = OFF

# Binary Logging (disable for test env for better performance)
skip-log-bin

# Optimizer Settings
optimizer_search_depth = 10
optimizer_switch = 'mrr=on,mrr_cost_based=on,join_cache_incremental=on,join_cache_hashed=on'

# For analyzing slow queries
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# Character Set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
